{"version":3,"sources":["../src/createRenderer.js"],"names":["createRenderer","tracker","options","overrides","renderer","marked","Renderer","getTocPosition","toc","level","currentLevel","children","length","populateInlineContent","content","contentArray","split","extractedElements","map","text","elementIdMatch","match","tree","splice","indexOf","elements","he","decode","addElement","tag","props","elementId","nextElementId","inlineContent","Array","isArray","createElement","Object","assign","key","context","push","code","language","CodeComponent","className","dangerouslySetInnerHTML","__html","highlight","html","paragraph","blockquote","link","href","title","br","hr","strong","del","sup","em","heading","currentId","slice","replace","toLowerCase","id","join","lastToc","tocPosition","list","body","ordered","listitem","table","header","thead","tbody","tablerow","tablecell","flag","align","undefined","codespan","image","src","alt"],"mappings":"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","file":"createRenderer.js","sourcesContent":["import marked from 'marked';\nimport he from 'he';\n\nexport default function createRenderer (tracker, options, overrides = {}) {\n  const renderer = new marked.Renderer();\n\n  function getTocPosition (toc, level) {\n    var currentLevel = toc.children;\n    while (true) {\n      if (!currentLevel.length || currentLevel[currentLevel.length - 1].level === level) {\n        return currentLevel;\n      } else {\n        currentLevel = currentLevel[currentLevel.length - 1].children;\n      }\n    }\n  }\n\n  function populateInlineContent (content = '') {\n    const contentArray = content.split(/(\\{\\{.*?\\}\\})/);\n    const extractedElements = contentArray.map(function (text) {\n      const elementIdMatch = text.match(/\\{\\{(.*)\\}\\}/);\n      if (elementIdMatch) {\n        tracker.tree.splice(tracker.tree.indexOf(tracker.elements[elementIdMatch[1]]), 1)\n        return tracker.elements[elementIdMatch[1]];\n      } else if (text != '') {\n        return he.decode(text);\n      }\n\n      return null;\n    });\n\n    return extractedElements;\n  }\n\n  function addElement (tag, props = {}, children) {\n    const elementId = tracker.nextElementId++;\n    let inlineContent = null;\n\n    if (children) {\n      inlineContent = Array.isArray(children) ? children.map(populateInlineContent) : populateInlineContent(children)\n    }\n\n    tracker.elements[elementId] = options.createElement((options.elements && options.elements[tag]) || tag, Object.assign({\n      key: elementId,\n    }, props, options.elements && options.elements[tag] ? {context: tracker.context} : {}), inlineContent);\n\n    tracker.tree.push(tracker.elements[elementId]);\n\n    return `{{${elementId}}}`;\n  }\n\n  renderer.code = overrides.code || function (code, language) {\n    const elementId = tracker.nextElementId++;\n\n    function CodeComponent () {\n      return options.createElement('pre', null, options.createElement('code', {\n        className: `language-${language}`,\n        dangerouslySetInnerHTML: {__html: options.highlight ? options.highlight(language, code) : code}\n      }))\n    }\n\n    tracker.elements[elementId] = options.createElement(CodeComponent, {key: elementId});\n\n    tracker.tree.push(tracker.elements[elementId]);\n\n    return `{{${elementId}}}`;\n  };\n\n  renderer.html = overrides.html || function (html) {\n    const elementId = tracker.nextElementId++;\n\n    tracker.tree.push(options.createElement('div', {\n      key: elementId,\n      dangerouslySetInnerHTML: {\n        __html: html\n      }\n    }))\n  };\n\n  renderer.paragraph = overrides.paragraph || function (text) {\n    return addElement('p', null, text);\n  }\n\n  renderer.blockquote = overrides.blockquote || function (text) {\n    return addElement('blockquote', null, text);\n  }\n\n  renderer.link = overrides.link || function (href, title, text) {\n    return addElement('a', {href, title}, text);\n  }\n\n  renderer.br = overrides.br || function () {\n    return addElement('br');\n  }\n\n  renderer.hr = overrides.hr || function () {\n    return addElement('hr');\n  }\n\n  renderer.strong = overrides.strong || function (text) {\n    return addElement('strong', null, text);\n  }\n\n  renderer.del = overrides.del || function (text) {\n    return addElement('del', null, text);\n  }\n\n  renderer.sup = overrides.sup || function (text) {\n    return addElement('sup', null, text);\n  }\n\n  renderer.em = overrides.em || function (text) {\n    return addElement('em', null, text);\n  }\n\n  renderer.heading = overrides.heading || function (text, level) {\n    tracker.currentId = tracker.currentId.slice(0, level - 1);\n    tracker.currentId.push(text.replace(/\\s/g, '-').toLowerCase())\n\n    const id = tracker.currentId.join('-');\n    const lastToc = tracker.toc[tracker.toc.length - 1];\n\n    if (!lastToc || lastToc.level > level) {\n      tracker.toc.push({\n        id: id,\n        title: text,\n        level: level,\n        children: []\n      });\n    } else {\n      const tocPosition = getTocPosition(lastToc, level);\n\n      tocPosition.push({\n        id: id,\n        title: text,\n        level: level,\n        children: []\n      });\n    }\n\n    return addElement(`h${level}`, {\n      id\n    }, text);\n  }\n\n  renderer.list = overrides.list || function (body, ordered) {\n    return addElement(ordered ? 'ol' : 'ul', null, body);\n  }\n\n  renderer.listitem = overrides.listitem || function (text) {\n    return addElement('li', null, text);\n  }\n\n  renderer.table = overrides.table || function (header, body) {\n    return addElement('table', null, [\n      addElement('thead', null, header),\n      addElement('tbody', null, body)\n    ]);\n  }\n\n  renderer.thead = overrides.thead || function (content) {\n    return addElement('thead', null, content)\n  }\n\n  renderer.tbody = overrides.tbody || function (content) {\n    return addElement('tbody', null, content)\n  }\n\n  renderer.tablerow = overrides.tablerow || function (content) {\n    return addElement('tr', null, content)\n  }\n\n  renderer.tablecell = overrides.tablecell || function (content, flag) {\n    const tag = flag.header ? 'th' : 'td'\n    return addElement(tag, {className: flag.align ? `text-${flag.align}` : undefined}, content)\n  }\n\n  renderer.codespan = overrides.codespan || function (text) {\n    return addElement('code', null, text)\n  }\n\n  renderer.image = overrides.image || function (href, title, text) {\n    return addElement('img', {src: href, alt: text})\n  }\n\n  return renderer;\n}\n"]}